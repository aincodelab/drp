<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Aktivitas Harian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Mengatur agar thumbnail memiliki tinggi tetap namun tetap fleksibel */
        .img-container { height: 250px; }
        @media (min-width: 768px) {
            .img-container { height: auto; min-height: 200px; }
        }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800">
    <nav class="bg-white/80 backdrop-blur-md border-b sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-4 h-20 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-blue-200">L</div>
                <h1 class="text-xl font-black text-slate-800 tracking-tighter">LogAktivitas</h1>
            </div>
            <a href="admin.html" class="bg-slate-100 hover:bg-slate-200 text-slate-600 px-5 py-2.5 rounded-2xl text-xs font-bold transition-all">Panel Admin</a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-12 max-w-5xl">
        <header class="mb-12 text-center md:text-left">
            <h2 class="text-4xl font-black text-slate-900 leading-none">Arsip Publik</h2>
            <p class="text-slate-400 mt-3 font-medium">Laporan transparansi aktivitas yang dikelola secara profesional.</p>
        </header>

        <div id="loading" class="flex flex-col items-center justify-center py-32 opacity-50">
            <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-xs font-bold uppercase tracking-widest">Sinkronisasi...</p>
        </div>

        <div id="content-area" class="hidden space-y-8">
            <div id="activity-grid" class="grid grid-cols-1 gap-8"></div>
            
            <div class="flex items-center justify-between border-t border-slate-200 pt-10">
                <p class="text-xs font-bold text-slate-400">HALAMAN <span id="current-page-num" class="text-blue-600">1</span>/<span id="total-pages-num">1</span></p>
                <div class="flex gap-2">
                    <button onclick="changePage(-1)" id="prev-btn" class="px-6 py-3 border-2 border-slate-200 rounded-2xl text-xs font-bold hover:bg-white transition-all disabled:opacity-20">SEBELUMNYA</button>
                    <button onclick="changePage(1)" id="next-btn" class="px-6 py-3 bg-slate-900 text-white rounded-2xl text-xs font-bold hover:bg-slate-800 transition-all disabled:opacity-20">BERIKUTNYA</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxUCiEzApV6XBTB9OIzTJ0ffK0x8sMmgTDPri_haTsJdMCZgRzUCQ10QrgAPr7LJPSV/exec';
        let allData = [];
        let currentPage = 1;
        const itemsPerPage = 6;

        async function fetchData() {
            try {
                const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'read', session: { role: 'Admin' } }) });
                const json = await res.json();
                if (json.success) {
                    allData = json.data;
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('content-area').classList.remove('hidden');
                    render();
                }
            } catch (err) { console.error(err); }
        }

        function render() {
            const container = document.getElementById('activity-grid');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const items = allData.slice(start, end);

            container.innerHTML = items.map(item => `
                <div onclick="goToDetail('${encodeURIComponent(JSON.stringify(item))}')" class="group bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-xl hover:shadow-slate-200/50 transition-all duration-500 cursor-pointer flex flex-col md:flex-row">
                    <!-- Container Gambar dengan background abu-abu tipis agar gambar terlihat jelas -->
                    <div class="md:w-72 lg:w-96 bg-slate-50 overflow-hidden flex-shrink-0 flex items-center justify-center img-container p-2">
                        <img src="${item.imageurl || 'https://via.placeholder.com/600x400'}" 
                             class="max-w-full max-h-full w-auto h-auto object-contain rounded-xl group-hover:scale-105 transition-transform duration-500" 
                             loading="lazy"
                             alt="Thumbnail Laporan">
                    </div>
                    <div class="p-8 flex flex-col justify-between flex-grow">
                        <div>
                            <div class="flex items-center gap-3 mb-4">
                                <span class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter">${item.display_owner}</span>
                                <span class="text-[10px] text-slate-300 font-bold tracking-widest uppercase">${new Date(item.waktu).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
                            </div>
                            <h3 class="text-2xl font-black text-slate-900 group-hover:text-blue-600 transition-colors duration-300 leading-tight mb-3">${item.judul}</h3>
                            <p class="text-slate-500 text-sm leading-relaxed line-clamp-2 font-medium">${item.deskripsi}</p>
                        </div>
                        <div class="mt-6 flex items-center text-blue-600 text-[10px] font-black uppercase tracking-widest">
                            Selengkapnya <span class="ml-2 group-hover:translate-x-2 transition-transform">â†’</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            const total = Math.ceil(allData.length / itemsPerPage) || 1;
            document.getElementById('current-page-num').innerText = currentPage;
            document.getElementById('total-pages-num').innerText = total;
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === total;
        }

        function changePage(step) { currentPage += step; window.scrollTo({ top: 0, behavior: 'smooth' }); render(); }
        function goToDetail(s) { localStorage.setItem('selected_activity', decodeURIComponent(s)); window.location.href = 'detail.html'; }
        window.onload = fetchData;
    </script>
</body>
</html>